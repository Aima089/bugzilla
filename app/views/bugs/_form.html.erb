<%= form_with(model: [@project, @bug], local: true) do |form| %>
  
  <% if @bug.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(@bug.errors.count, "error") %> prohibited this bug from being saved:</h2>
      <ul>
        <% @bug.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= form.label :title %>
    <%= form.text_field :title %>
  </div>
  <div class="field">
  <%= form.label :bug_type %>
  <%= form.select :bug_type, options_for_select(['Feature', 'Bug']), {include_blank: true}, { id: 'type_select' } %>
</div>

<div class="field" id="status_field">
  <%= form.label :status %>
  <%= form.select :status, options_for_select([]), { id: 'status_select' } %>
</div>

  <div class="field">
    <%= form.label :description %>
    <%= form.text_area :description %>
  </div>

  <div class="field">
    <%= form.label :deadline %>
    <%= form.date_select :deadline %>
  </div>
  <div class="field">
    <%= form.label :image, "Upload Image" %>
    <%= form.file_field :image %>
  </div>

  <div class="actions">
    <%= form.submit %>
  </div>
<% end %>

<script type="module">
  import handleBugForm from './controllers/bug_form_controller.js';

  document.addEventListener('DOMContentLoaded', function() {
    console.log("JavaScript is loaded");
    
    var statusSelect = document.getElementById('status_select');
    var typeSelect = document.getElementById('type_select');
    var statusField = document.getElementById('status_field');
    
    if (typeSelect && statusSelect && statusField) {
      console.log('Fields are available.');
      
      function updateStatusOptions() {
        var selectedType = typeSelect.value;
        if (selectedType === 'Feature') {
          statusField.style.display = 'block';
          statusSelect.innerHTML = `
            <option value="New">New</option>
            <option value="Started">Started</option>
            <option value="Completed">Completed</option>`;
        } else if (selectedType === 'Bug') {
          statusField.style.display = 'block';
          statusSelect.innerHTML = `
            <option value="New">New</option>
            <option value="Started">Started</option>
            <option value="Resolved">Resolved</option>`;
        } else {
          statusField.style.display = 'none';
          statusSelect.innerHTML = '';
        }
      }

      updateStatusOptions();
      typeSelect.addEventListener('change', updateStatusOptions);
    } else {
      console.error("One or more form elements not found.");
    }
  });

  handleBugForm();  // This will log "Handling bug form"
</script>
